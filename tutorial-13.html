<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="perihelion of poSTmortem">
<title>Of Hearing That Which Is Spoken</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<a href="." style="position: absolute; top: .5rem; left: .5rem;">Index</a>
<a href="https://github.com/nguillaumin/perihelion-m68k-tutorials"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
</head>
<body class="article">
<div id="header">
<h1>Of Hearing That Which Is Spoken</h1>
<div class="details">
<span id="author" class="author">perihelion of poSTmortem</span><br>
<span id="revdate">2002-07-28 (last edition of the initial revision)</span>
</div>
</div>
<div id="content">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I can kill with a word.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Dune<br>
<cite>the Movie</cite>
</div>
</div>
<div class="paragraph">
<p>No demo or game is complete without music. The nice blip-blop tunes known as chip music is
one of the sweetest forms of music that&#8217;s ever reached my ears. Seems some people don&#8217;t
quite fancy the type of music the ST has to offer, but I think it&#8217;s divine. I&#8217;m no musician,
that&#8217;s probably why a tutorial on sound has been somewhat delayed, but here it finally is. It&#8217;s
a small tutorial to get down the basics of the sound chip, I intend to follow up with another
tutorial on playing the <code>.ym</code> file format, created by Arnaud Carré for the ST-sound project. He&#8217;s
got a homepage over at <a href="http://leonard.oxg.free.fr" class="bare">http://leonard.oxg.free.fr</a>.</p>
</div>
<div class="paragraph">
<p>The Atari ST comes equipped with a so called PSG: Programmable Sound Generator. This is
yet another chip in the ST, the Yamaha YM-2149, fondly called "yammy". According to the ST
Internals, this cool chip sports lots of features, for example three independently
programmable sound generators, 15 logarithmically volume levels and 16 registers. Registers,
yes, just give me the tech specs, register addresses and I&#8217;ll start to outdo Mozart!</p>
</div>
<div class="paragraph">
<p>Things aren&#8217;t that easy though, it would take insanity to hard code the sound chip. By hard
coding I mean just entering numbers into the registers, rather than using some program to
make music. There is also a little something here, again according to the ST Internals, it&#8217;s not
possible to directly address the yammy registers. Instead, you have to put the desired
register number in <code>$ff8800</code>, and then you can put data in <code>$ff8802</code>, or read data from <code>$ff8800</code>.
Don&#8217;t worry, soon comes an explanation of how that applies to real life, but just to be
complete, here&#8217;s a listing of the registers.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Register</th>
<th class="tableblock halign-left valign-top">Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0,1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, length and pitch of channel A</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2,3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, length and pitch of channel B</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4,5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, length and pitch of channel C</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Noise generator</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 0: channel A tone on/off (0 = on, 1 = off)<br>
 Bit 1: channel B tone on/off (0 = on, 1 = off)<br>
 Bit 2: channel C tone on/off (0 = on, 1 = off)<br>
 Bit 3: channel A noise on/off (0 = on, 1 = off)<br>
 Bit 4: channel B noise on/off (0 = on, 1 = off)<br>
 Bit 5: channel C noise on/off (0 = on, 1 = off)<br>
 Bit 6: port A input/output<br>
 Bit 7: port B input/output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 0-3 channel A volume, if bit 4 set, envelope and bit 0-3 ignored</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 0-3 channel B volume, if bit 4 set, envelope and bit 0-3 ignored</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 0-3 channel C volume, if bit 4 set, envelope and bit 0-3 ignored</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11,12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sustain, 11 low byte and 12 high byte</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Waveform envelope</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14,15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port A and Port B, used for output</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Like I said, I&#8217;m not a musician and I don&#8217;t understand too much of this. For me, there are
only 4 interesting registers: 7-10. Why? Because with register 7, I can turn on and off
different channels, and with 8-10 I can determine the current volume and also set the
volume. In other words, registers 8-10 can be used to fade music in and out, as well as
create cool bars that go up and down to the beat of the music (or you can have three
pulsating sprites or whatever). Here&#8217;s some example code on how to use the yammy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                move.b  #7, $ff8800               ; access Yamaha register 7
                move.b  #%101, $ff8802            ; turn off channel A and C</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the comments say, this will turn off all (tone) sound from channels A and C. Note how
only a byte is moved in both instances, and note also that setting a bit means turning the
channel off. Here&#8217;s how to read the volume of channel A:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                move.b  #8, $ff8800               ; channel A volume
                move.b  $ff8800, d0               ; channel A volume in d0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Yep, when you want to read data, you put the register number in $ff8800 as usual, but then
you move the data from $ff8800. This obviously means that $ff8800 gets updated between
the two move instructions in some way. That&#8217;s all there is to it actually, but in practice it
becomes a little harder.</p>
</div>
<div class="paragraph">
<p>Sure, we have a basic working of the yammy, well, actually we don&#8217;t but we know how to use
it anyway. Time to play some music perhaps. Most music plays by hooking it up to the VBL,
and then just jump to some address in the music file. This of course means that the music
file has it&#8217;s own code routines to play the music, and does not only contain raw music data.
The XLR8 chip composer, which can be found at <a href="http://dhs.nu/" class="bare">http://dhs.nu/</a>, comes with both some
example files and the source code for playing them. A good place to start. Here is the code
the XLR8 chip composer suggests for playing the music:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                pea     0.w
                move.w  #32, -(sp)
                trap    #1
                addq.l  #6, sp

                moveq   #1, d0                    ; normal song-play mode
                bsr     music

                move.l  #music+2, $4d2            ; music in VBL
                move.w  #7,-(sp)                  ; wait for a key
                trap    #1
                addq.l  #2,sp

                moveq   #0,d0                     ; exit music
                bsr     music

                clr.l   $4d2                      ; clear VBL
                pea     0.w                       ; Back to desktop
                trap    #1

music           incbin  f:\1.xms                  ; music file to include</code></pre>
</div>
</div>
<div class="paragraph">
<p>Well well, they don&#8217;t even go out of supervisor mode, naughty naughty. Fairly straightforward
and easy, there is only one thing that would trouble us, the <code>$4d2</code> address. We&#8217;re used to
have the VBL hooked up to <code>$70</code>. At address <code>$4ce</code> there are eight long words that point to VBL
routines. These VBL routines are executed one after another. So by writing to say <code>$4ce</code> and
<code>$4ce</code>+4, we can have two different VBL routines that get executed one after the other.</p>
</div>
<div class="paragraph">
<p>In the source code above, the author chooses to put the VBL routine in the second of these
eight VBL routines. Our way of writing to the <code>$70</code> instead, is a bit rawer. Writing to $70
disables all VBL routines except the <code>$70</code>. This means that we know that our, and only our VBL
routine is the one to run. In any way, if we spot a memory address close to <code>$4ce</code> in some
future source code, we know that it&#8217;s a VBL routine. Translated into how we would code it, it
looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                moveq   #1, d0                    ; normal song-play mode

                jsr     initialise

                moveq   #1, d0                    ; normal song play
                bsr     music                     ; start music

                move.l  $70, -(a7)                ; backup $70
                move.l  #main, $70                ; main routine on VBL
                move.w  #7, -(a7)
                trap    #1
                addq.l  #2, a7                    ; wait keypress
                move.l  (a7)+, $70                ; restore $70
                jsr     restore

                moveq   #0, d0
                bsr     music                     ; stop music

                clr.l   -(a7)
                trap    #1                        ; exit

main
                movem.l d0-d7/a0-a6, -(a7)        ; backup registers

                bsr     music+2                   ; play music

                movem.l (a7)+,d0-d7/a0-a6         ; restore registers
                rte

include         initlib.s

                section data
music           incbin 1.xms                      ; music file to include</code></pre>
</div>
</div>
<div class="paragraph">
<p>Well, what do you know, ours became longer, but it&#8217;s built for more add-ons, and it also has
some backup feature such as getting out of supervisor mode, and it also has a <code>section data</code>.
Doesn&#8217;t really matter, both ways are equally fast really. Speaking of fast, there&#8217;s an
instruction here that I don&#8217;t think we&#8217;ve encountered before, the <code>moveq</code> instruction. <code>moveq</code>
stands for <strong>MOVE</strong> <strong>Q</strong>uick. It works pretty much as a normal move, but it can only move
quantities in the range of -128 to +127 (a byte). The data does get sign extended though,
meaning it will take up a 32-bit quantity (long word). Thus a <code>moveq.l #0, d0</code> clears <code>d0</code>
faster than a <code>clr.l d0</code>. Handy little instruction actually. You will also notice how I put <code>$70</code>
on the stack instead of saving it to a variable.</p>
</div>
<div class="paragraph">
<p>So we have a way of playing music, at least music composed with the XLR8 chip composer.
This is a little thin, so against our better knowledge, we decide it would be fun to do some
volume meters as well. In order to do these VU bars, we have to play the music, read
registers 8-10 (for volume) and then paint the VU bars. Yes, it&#8217;s true, the yammy has three
sound channels, meaning it can play up to three different sounds at once. It also has some
noise generator I think so it&#8217;s able to play four different sounds at once.</p>
</div>
<div class="paragraph">
<p>The volume is represented by the four least significant bits, meaning it&#8217;s a value between 0
and 15 (<code>%1111</code>), would be smart to paint one line of VU bar for each volume, right? So at
volume 15, the VU bar takes up 15 lines, this can be a little small though, so just for fun we
decide to leave every second line blank (background coloured), thus volume 15 will take up
30 lines instead. Since we have 15 different VU lines, each line can have it&#8217;s own colour and
we&#8217;ll still have one over for the background as well. Seems the ST was made for these things!
Actually, it wasn&#8217;t, it&#8217;s just normal for computers to have many things on binary bounders.
Thus the powers of two (such as 16, or 0-15) show up a lot.</p>
</div>
<div class="paragraph">
<p>As we know, the volume data may contain other stuff than just the four volume bits, so in
order to keep only those bits, we have to and off the other bits. Otherwise the volume data
might contain a number larger than 15 and that will screw us up big time, making us do
stupid things like drawing outside of the screen, which will probably result in a crash.</p>
</div>
<div class="paragraph">
<p>Now, to decide on how to draw the volume bars. What, should this be a problem? Just do a
<code>dbf</code> loop according to the volume and paint as many lines as the volume. Yes, that won&#8217;t
work. Say one VBL the volume is 12, then the other VBL it&#8217;s 5, but the VU bar will still be 12
lines high since we don&#8217;t delete it.</p>
</div>
<div class="paragraph">
<p>So on every VBL, we first delete the VU bar and then paint it. This can be done, but actually
it&#8217;s smarter to first paint the VU bar, then delete it. The delete part is more generic, and thus
easier to fit into a loop, while the paint part requires colour updates and so on. Thus, the VU
bar routine will be to first paint all three VU bars to the max, then delete as many lines as the
inverted volume (volume 15 means delete nothing, volume 0 means delete 15). This will work
nicely. Actually, theory part over, time for source code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                jsr     initialise

                moveq   #1, d0                    ; normal song play mode
                bsr     music

                move.l  #palette, a0              ; pointer to palette
                movem.l (a0)+, d0-d7              ; palette in d0-d7
                movem.l d0-d7, $ff8240            ; apply palette

                move.l  $70, -(a7)                ; backup $70
                move.l  #main, $70                ; start main routine

                move.w  #7, -(a7)
                trap    #1
                addq.l  #2, a7                    ; wait keypress

                move.l  (a7)+, $70                ; restore old $70

                moveq   #0, d0                    ; stop music
                bsr     music

                jsr     restore

                clr.l   -(a7)
                trap    #1                        ; exit

main
                movem.l d0-d7/a0-a6, -(a7)

                bsr     music+2                   ; play music

; put in VU bars
                move.l  $44e, a0                  ; get screen address
                add.l   #160*199-(15*2)*160, a0   ; bottom area of screen
                move.l  #bar, a1                  ; point to bar colours

                rept    15                        ; 15 max volume
                movem.l (a1)+, d0-d1              ; VU bar colour in d1-d2
                movem.l d0-d1, (a0)               ; first VU bar
                addq.l  #8, a0                    ; next VU bar
                movem.l d0-d1, (a0)               ; second VU bar
                addq.l  #8, a0                    ; next VU bar
                movem.l d0-d1, (a0)               ; third VU bar
                add.w   #320-16, a0               ; two lines down, two bars left
                endr

; delete VU bars depending on volume
                move.l  $44e, a0                  ; get screen address
                add.l   #160*199-(15*2)*160, a0   ; bottom area of screen

                moveq.l #0, d0                    ; clear d0
                move.b  #8, $ff8800               ; channel a volume
                move.b  $ff8800, d0               ; put volume in d0
                jsr     del_bar

                moveq.l #0, d0                    ; clear d0
                move.b  #9, $ff8800               ; channel b volume
                move.b  $ff8800, d0               ; put volume in d0
                add.l   #8, a0                    ; next VU bar
                jsr     del_bar

                moveq.l #0, d0                    ; clear d0
                move.b  #10, $ff8800              ; channel c volume
                move.b  $ff8800, d0               ; put volume in d0
                add.l   #8, a0                    ; next VU bar
                jsr     del_bar

                movem.l (a7)+, d0-d7/a0-a6
                rte

del_bar
; screen address of top line in a0
; volume in d0, gets detroyed
                move.l  a0, -(a7)                 ; backup a0
                move.l  a1, -(a7)                 ; backup a1
                and.b   #%1111, d0                ; keep only lowest 4 bits

                move.l  #delete, a1               ; beginning of delete blocks
                mulu    #12, d0                   ; length of one delete block
                add.l   d0, a1                    ; skip some delete instructions
                jmp     (a1)                      ; jump to correct delete position

delete
                rept    15
                clr.l   (a0)                      ; clear two bit planes
                clr.l   4(a0)                     ; clear two bit planes
                add.l   #320, a0                  ; hop two lines down
                endr

                move.l  (a7)+, a1                 ; restore a1
                move.l  (a7)+, a0                 ; restore a0
                rts

                include initlib.s

                section data
bar
; colour data for each line of VU bar
                dc.w    $00ff, $00ff, $00ff, $00ff
                dc.w    $0000, $00ff, $00ff, $00ff
                dc.w    $00ff, $0000, $00ff, $00ff
                dc.w    $0000, $0000, $00ff, $00ff
                dc.w    $00ff, $00ff, $0000, $00ff
                dc.w    $0000, $00ff, $0000, $00ff
                dc.w    $00ff, $0000, $0000, $00ff
                dc.w    $0000, $0000, $0000, $00ff
                dc.w    $00ff, $00ff, $00ff, $0000
                dc.w    $0000, $00ff, $00ff, $0000
                dc.w    $00ff, $0000, $00ff, $0000
                dc.w    $0000, $0000, $00ff, $0000
                dc.w    $00ff, $00ff, $0000, $0000
                dc.w    $0000, $00ff, $0000, $0000
                dc.w    $00ff, $0000, $0000, $0000
                dc.w    $00ff, $0000, $0000, $0000

palette
                dc.w    $000, $023, $023, $024, $024, $025, $026, $026
                dc.w    $027, $027, $227, $327, $427, $527, $627, $727

music           incbin  instinct.xms              ; musicfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we go! Setup the music to work, then put in the palette. Backup the old <code>$70</code> by putting
it on the stack, put in my own <code>$70</code> routine, wait for keypress, shut down music, restore and
exit. All the usual stuff.</p>
</div>
<div class="paragraph">
<p>The main routine starts off by playing the music, that one simple command is enough to keep
the music running. Now comes the interesting part: putting in the VU bars. I get the screen
address, and go to the bottom area of the screen. This means go to the absolute bottom, line
199, and then hop 30 lines up. Because I want to paint the entire VU bar, and the VU bar is
15×2 lines high (max 15 volume and every second line is interlaced).</p>
</div>
<div class="paragraph">
<p>The actual painting of the VU bar is a bit tricky. I point to the bar label, which contains colour
data for the VU bars. Each little four word block here is data for a bit plane, so the first line is
colour 15. The reason for the two leading 0&#8217;s, is that I don&#8217;t want the entire bit plane filled, in
this way, only 8 pixels out of sixteen will be set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                dc.w    $00ff, $00ff, $00ff, $00ff</code></pre>
</div>
</div>
<div class="paragraph">
<p>is the same as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                dc.w    %0000000011111111
                dc.w    %0000000011111111
                dc.w    %0000000011111111
                dc.w    %0000000011111111</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we know that by putting this into the screen memory, we will have 8 pixels with colour 0,
and then 8 pixels with colour 15. The next entry is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                dc.w    $0000, $00ff, $00ff, $00ff</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is the same as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                dc.w    %0000000000000000
                dc.w    %0000000011111111
                dc.w    %0000000011111111
                dc.w    %0000000011111111</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we put this into screen memory, we get colour 14 in the last 8 pixels.</p>
</div>
<div class="paragraph">
<p>When pointing to the bar label, <code>a1</code> points to memory that contains this data:
<code>$00ff00ff00ff00ff</code>. This data I move into <code>d0</code> and <code>d1</code> with a <code>movem</code> instruction, then I put that
data into the screen memory. Adding 8 to the screen memory pointer will put me on the next
VU bar, 16 pixels to the right, and then I move that same colour data into the screen memory
there, and repeat one last time. Then I need to correct the screen pointer: by adding 320, I
move two lines down, and then I need to subtract 16 from that to be on the first VU bar
position. Repeat all this 15 times to paint in all three VU bars full.</p>
</div>
<div class="paragraph">
<p>Now the time has come to delete the VU bars, so that they will reflect the value of the
volume. Again, get screen memory and go to the bottom area, pointing right at the topmost
line of the first VU bar. Clear <code>d0</code> just to be sure there&#8217;s no garbage, and read Yamaha register
8, which is channel A volume. Now the volume is in <code>d0</code>, and the screen address is in <code>a0</code>, jump
into the <code>del_bar</code> routine to delete the bar.</p>
</div>
<div class="paragraph">
<p>The <code>del_bar</code> routine is also a bit tricky, and uses an almost dirty method. Backup the registers
so that they don&#8217;t get destroyed. This is good practice for sub routines, so that other
programmers can count on calling routines without having data destroyed. And away all bits
but the first four. Now we have pure volume data in <code>d0</code>.</p>
</div>
<div class="paragraph">
<p>It would be tempting to just go through a <code>dbf</code> loop to clear out the lines, but this won&#8217;t work.
A <code>dbf</code> loop always executes once, but in some circumstances, we don&#8217;t want the delete loop
to execute even once. So instead of having a loop, I have 15 blocks of delete data, each
block deletes one line of VU bar. By jumping into the correct block, I take away the exact
number of VU bar lines. Each delete block looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>                clr.l   (a0)                      ; clear two bit planes
                clr.l   4(a0)                     ; clear two bit planes
                add.l   #320, a0                  ; hop two lines down</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will clear out the four bit planes of a line, and then hop two lines down. This block takes
12 memory positions. Usually, an instruction takes a long word to store, these three
instructions are no exceptions. Since all instructions just get loaded into memory, we can
easily jump to them. Go into MonST mode to see this clear, in the instruction window, you&#8217;ll
see all instructions, and to the left of them you&#8217;ll see what memory position they occupy. By
adding 4 to the program counter, you usually skip one instruction.</p>
</div>
<div class="paragraph">
<p>For example, by jumping to the start of the delete blocks+12, we will skip one delete block.
In the <code>del_bar</code> routine, I have 15 delete blocks, I let <code>a1</code> point to the beginning of these
blocks. Then I multiply the volume by 12, since this is the size of each delete block, add that
value to <code>a1</code>, and jump to the address a1 contains.</p>
</div>
<div class="paragraph">
<p>Say that we have volume one, this means execute 14 delete blocks, which will leave only one
line of VU bar left. 1×12 = 12, thus we will jump to the beginning of the delete blocks+12,
which will let us skip one delete block, and then we have 14 left. Here&#8217;s how it looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Memory position (fictional)
$0              move.l  $10, a1                   ; beginning of delete blocks
$4              mulu    #12, d0                   ; length of one delete block
                ; d0 contains 12
$8              add.l d0, a1                      ; skip some delete instructions
                ; a1 now contains $1c
$c              jmp (a1)                          ; jump to $1c

$10             clr.l   (a0)                      ; clear two bit planes
$14             clr.l   4(a0)                     ; clear two bit planes
$18             add.l   #320, a0                  ; hop two lines down

$1c             clr.l (a0)                        ; clear two bit planes
$20             clr.l 4(a0)                       ; clear two bit planes
$24             add.l #320, a0                    ; hop two lines down

$28             clr.l (a0)                        ; clear two bit planes
$2c             clr.l 4(a0)                       ; clear two bit planes
$30             add.l #320, a0                    ; hop two lines down
                ...                               ; 13 more delete blocks</pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s that. In short, the program only runs a VBL routine. This VBL routine plays the music,
and then paints in VU bars at max. Then the volume is read from yammy registers, for each
volume read, the <code>del_bar</code> routine is called which deletes as many lines as the inverted
volume. Then add 8 to the screen memory to point to the next VU bar, read the volume and
call the <code>del_bar</code> routine.</p>
</div>
<div class="paragraph">
<p>With this knowledge of the volume workings, you can have just about any effect tied to the
volume. I first had the background colour be set by the three channels, channel A for red
colour, channel B for green and channel C for blue. This created quite the psychedelic
background I can tell you ☺ One cool thing would be to have three Xenon 1 ships, that
morph back and forth between tank and ship, say that volume 15 means complete tank
morph, and 0 means ship, then volume 7 would be morph in between those. Once again,
your fantasy can run free!</p>
</div>
<div class="paragraph">
<p>In the next tutorial, I hope to cover the <code>.ym</code> file format as described in the beginning. This
will mean setting up our own routine to write raw data into the sound chip, which should be
quite easy. Just put register number as usual, then write the data found in the <code>.ym</code> file. Stay
tuned&#8230;&#8203;</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-10-29 22:52:39 UTC
</div>
</div>
</body>
</html>